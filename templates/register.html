{% extends "base.html" %}

{% block title %}SmartAssist | Register{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/register.css') }}">
{% endblock %}

{% block nav_links %}
<a href="/">Home</a>
<a href="/login">Login</a>
{% endblock %}

{% block content %}
<!-- Page Content -->
<div class="page-content">
  <div class="register-wrapper">
    <!-- Left Side - Join Section -->
    <div class="register-left">
      <div class="join-content">
        <div class="logo-large">
          <img src="{{ url_for('static', path='assets/images/logo.png') }}" alt="SmartAssist Logo">
        </div>
        <h1>Join SmartAssist!</h1>
        <p>Create your account and unlock access to all campus services and resources.</p>

        <div class="benefit-list">
          <div class="benefit-item">
            <i class="fas fa-check-circle"></i>
            <span>AI-Powered Campus Support</span>
          </div>
          <div class="benefit-item">
            <i class="fas fa-check-circle"></i>
            <span>Instant Ticket Management</span>
          </div>
          <div class="benefit-item">
            <i class="fas fa-check-circle"></i>
            <span>Interactive Campus Maps</span>
          </div>
          <div class="benefit-item">
            <i class="fas fa-check-circle"></i>
            <span>24/7 Availability</span>
          </div>
          <div class="benefit-item">
            <i class="fas fa-check-circle"></i>
            <span>Personalized Experience</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side - Registration Form -->
    <div class="register-right">
      <div class="register-header">
        <h2>Create Account</h2>
        <p>Fill in your details to get started</p>
      </div>

      <!-- Backend messages -->
      {% if error %}
      <div class="alert-message error">
        <i class="fas fa-exclamation-circle"></i>
        <span>{{ error }}</span>
      </div>
      {% elif message %}
      <div class="alert-message success">
        <i class="fas fa-check-circle"></i>
        <span>{{ message }}</span>
      </div>
      {% endif %}

      <form action="/register" method="post" id="registerForm">
        <div class="form-grid">
          <div class="form-group">
            <label>Full Name <span class="required">*</span></label>
            <div class="input-wrapper">
              <i class="fas fa-user input-icon"></i>
              <input type="text" name="full_name" id="full_name" placeholder="John Doe" required />
            </div>
          </div>

          <div class="form-group">
            <label>Role <span class="required">*</span></label>
            <div class="input-wrapper">
              <i class="fas fa-user-tag input-icon"></i>
              <select name="role" id="role" required>
                <option value="">Select your role</option>
                <option value="student">ðŸŽ“ Student</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Email Address <span class="required">*</span></label>
          <div class="input-wrapper">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" name="email" id="email" placeholder="john@tamucc.edu" required />
          </div>
        </div>

        <div class="form-group">
          <label>Password <span class="required">*</span></label>
          <div class="input-wrapper">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" name="password" id="password" class="has-toggle"
              placeholder="Create a strong password" required />
            <i class="fas fa-eye password-toggle" onclick="togglePassword('password')"></i>
          </div>
          <div class="password-strength" id="passwordStrength">
            <div class="password-strength-bar" id="strengthBar"></div>
          </div>
        </div>

        <div class="form-group">
          <label>Confirm Password <span class="required">*</span></label>
          <div class="input-wrapper">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" name="confirm_password" id="confirm_password" class="has-toggle"
              placeholder="Re-enter your password" required />
            <i class="fas fa-eye password-toggle" onclick="togglePassword('confirm_password')"></i>
          </div>
        </div>

        <button type="submit" class="register-btn">
          <i class="fas fa-user-plus"></i> Create Account
        </button>
      </form>

      <p class="footer-text">
        Already have an account? <a href="/login">Sign in here</a>
      </p>

      <p class="terms">
        By registering, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
      </p>

      <p style="text-align: center; margin-top: 1.5rem; font-size: 0.8rem; color: #999;">
        Â© 2025 TAMU-CC SmartAssist. All rights reserved.
      </p>
    </div>
  </div>
</div> <!-- Close page-content -->
{% endblock %}

{% block extra_scripts %}
<script>
  document.querySelector('form').addEventListener('submit', function (event) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;

    if (password !== confirmPassword) {
      event.preventDefault();
      alert('Passwords do not match. Please try again.');
    }
  });
</script>
<script>
  // Password strength checker
  const passwordInput = document.getElementById('password');
  const strengthIndicator = document.getElementById('passwordStrength');
  const strengthBar = document.getElementById('strengthBar');

  passwordInput.addEventListener('input', function () {
    const password = this.value;
    if (password.length === 0) {
      strengthIndicator.classList.remove('active');
      return;
    }

    strengthIndicator.classList.add('active');
    let strength = 0;

    // Check password criteria
    if (password.length >= 8) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/\d/.test(password)) strength++;
    if (/[^a-zA-Z\d]/.test(password)) strength++;

    // Update strength bar
    strengthBar.className = 'password-strength-bar';
    if (strength <= 1) {
      strengthBar.classList.add('weak');
    } else if (strength <= 3) {
      strengthBar.classList.add('medium');
    } else {
      strengthBar.classList.add('strong');
    }
  });

  // Toggle password visibility
  function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const icon = event.target;

    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.remove('fa-eye');
      icon.classList.add('fa-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.remove('fa-eye-slash');
      icon.classList.add('fa-eye');
    }
  }

  // Form validation
  document.getElementById('registerForm').addEventListener('submit', function (event) {
    const email = document.querySelector('input[name="email"]').value;
    const password = document.querySelector('input[name="password"]').value;
    const confirmPassword = document.querySelector('input[name="confirm_password"]').value;
    const role = document.querySelector('select[name="role"]').value;

    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('Please enter a valid email address.');
      event.preventDefault();
      return;
    }

    // Password validation
    if (password.length < 6) {
      alert('Password must be at least 6 characters long.');
      event.preventDefault();
      return;
    }

    // Confirm password validation
    if (password !== confirmPassword) {
      alert('Passwords do not match.');
      event.preventDefault();
      return;
    }

    // Role validation
    if (!role) {
      alert('Please select a role.');
      event.preventDefault();
    }
  });
</script>
{% endblock %}